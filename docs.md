<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Provider][1]
    -   [Parameters][2]
    -   [deploy][3]
        -   [Parameters][4]
    -   [onConnect][5]
        -   [Parameters][6]
        -   [Examples][7]
    -   [loginUrl][8]
        -   [Parameters][9]
        -   [Examples][10]
    -   [appUrl][11]
        -   [Parameters][12]
        -   [Examples][13]
    -   [sessionTimeoutUrl][14]
        -   [Parameters][15]
        -   [Examples][16]
    -   [invalidTokenUrl][17]
        -   [Parameters][18]
        -   [Examples][19]
    -   [registerPlatform][20]
        -   [Parameters][21]
    -   [getPlatform][22]
        -   [Parameters][23]
    -   [deletePlatform][24]
        -   [Parameters][25]
    -   [getAllPlatforms][26]
    -   [messagePlatform][27]
        -   [Parameters][28]
-   [lti1_3Login][29]
    -   [Parameters][30]
-   [Platform][31]
    -   [Parameters][32]
    -   [platformName][33]
        -   [Parameters][34]
    -   [platformUrl][35]
        -   [Parameters][36]
    -   [platformClientId][37]
        -   [Parameters][38]
    -   [platformKid][39]
    -   [platformPublicKey][40]
    -   [platformPrivateKey][41]
    -   [platformAuthConfig][42]
        -   [Parameters][43]
    -   [platformAuthEndpoint][44]
        -   [Parameters][45]
    -   [platformAccessTokenEndpoint][46]
        -   [Parameters][47]
    -   [platformAccessToken][48]
    -   [remove][49]
-   [Auth][50]
    -   [generateProviderKeyPair][51]
    -   [validateToken][52]
        -   [Parameters][53]
    -   [verifyToken][54]
        -   [Parameters][55]
    -   [oidcValidationSteps][56]
        -   [Parameters][57]
    -   [getAccessToken][58]
        -   [Parameters][59]
    -   [deleteNonce][60]
        -   [Parameters][61]
    -   [deleteAccessToken][62]
        -   [Parameters][63]
-   [Database][64]
    -   [Get][65]
        -   [Parameters][66]
    -   [Insert][67]
        -   [Parameters][68]
    -   [Modify][69]
        -   [Parameters][70]
    -   [Delete][71]
        -   [Parameters][72]

## Provider

Exposes methods for easy manipualtion of the LTI standard as a LTI Provider and a "server" object to manipulate the Express instance

### Parameters

-   `options` **[Object][73]** Lti Provider options.

### deploy

Starts listening to a given port for LTI requests

#### Parameters

-   `port` **[number][74]** The port the Provider should listen to

### onConnect

Sets the callback function called whenever theres a sucessfull connection, exposing a Conection object containing the id_token decoded parameters.

#### Parameters

-   `_connect_callback` **[Function][75]** Function that is going to be called everytime a platform sucessfully connects to the provider.
-   `options` **[Object][73]?** Options configuring the usage of cookies to pass the Id Token data to the client.
    -   `options.maxAge` **[Number][74]** MaxAge of the cookie in miliseconds. (optional, default `1000*60*60`)
    -   `options.secure` **[Boolean][76]** Secure property of the cookie. (optional, default `true`)
    -   `options.sessionTmeout` **[Function][75]?** Route function executed everytime the session expires. It must in the end return a 401 status, even if redirects ((req, res, next) => {res.sendStatus(401)}).
    -   `options.invalidToken` **[Function][75]?** Route function executed everytime the system receives an invalid token or cookie. It must in the end return a 401 status, even if redirects ((req, res, next) => {res.sendStatus(401)}).

#### Examples

```javascript
.onConnect((conection, response)=>{response.send(connection)}, {secure: true})
```

### loginUrl

Gets/Sets login Url responsible for dealing with the OIDC login flow. If no value is set "/login" is used.

#### Parameters

-   `url` **[string][77]** Login url.

#### Examples

```javascript
provider.loginUrl('/login')
```

### appUrl

Gets/Sets main application Url that will receive the final decoded Idtoken. If no value is set "/" (root) is used.

#### Parameters

-   `url` **[string][77]** App url.

#### Examples

```javascript
provider.appUrl('/app')
```

### sessionTimeoutUrl

Gets/Sets session timeout Url that will be called whenever the system encounters a session timeout. If no value is set "/sessionTimeout" is used.

#### Parameters

-   `url` **[string][77]** Session timeout url.

#### Examples

```javascript
provider.sessionTimeoutUrl('/sesstimeout')
```

### invalidTokenUrl

Gets/Sets invalid token Url that will be called whenever the system encounters a invalid token or cookie. If no value is set "/invalidToken" is used.

#### Parameters

-   `url` **[string][77]** Invalid token url.

#### Examples

```javascript
provider.invalidTokenUrl('/invtoken')
```

### registerPlatform

Registers a platform.

#### Parameters

-   `url`  
-   `name` **[string][77]** Platform nickname.
-   `client_id` **[string][77]** Client Id generated by the platform.
-   `authentication_endpoint` **[string][77]** Authentication endpoint that the tool will use to authenticate within the platform.
-   `accesstoken_endpoint`  
-   `auth_config` **[object][73]** Authentication method and key for verifying messages from the platform. {method: "RSA_KEY", key:"PUBLIC KEY..."}
    -   `auth_config.method` **[String][77]** Method of authorization "RSA_KEY" or "JWK_KEY" or "JWK_SET".
    -   `auth_config.key` **[String][77]** Either the RSA public key provided by the platform, or the JWK key, or the JWK keyset address.
-   `Url` **[string][77]** Platform url.

### getPlatform

Gets a platform.

#### Parameters

-   `url` **[string][77]** Platform url.

### deletePlatform

Deletes a platform.

#### Parameters

-   `url` **[string][77]** Platform url.

### getAllPlatforms

Gets all platforms.

### messagePlatform

Sends message to the platform

#### Parameters

-   `idtoken` **[Object][73]** Idtoken for the user

## lti1_3Login

Handles the Lti 1.3 initial login flow (OIDC protocol).

### Parameters

-   `request` **[object][73]** Login request object sent by consumer.
-   `platform` **[object][73]** Platform Object.

## Platform

Class representing a registered platform.

### Parameters

-   `name` **[string][77]** Platform name.
-   `platform_url` **[string][77]** Platform url.
-   `client_id` **[string][77]** Client Id generated by the platform.
-   `authentication_endpoint` **[string][77]** Authentication endpoint that the tool will use to authenticate within the platform.
-   `accesstoken_endpoint` **[string][77]** Access token endpoint for the platform.
-   `kid` **[string][77]** Key id for local keypair used to sign messages to this platform.
-   `_ENCRYPTIONKEY` **[string][77]** Encryption key used
-   `_auth_config` **[Object][73]** Authentication configurations for the platform.

### platformName

Sets/Gets the platform name.

#### Parameters

-   `name` **[string][77]?** Platform name.

### platformUrl

Sets/Gets the platform url.

#### Parameters

-   `url` **[string][77]?** Platform url.

### platformClientId

Sets/Gets the platform client id.

#### Parameters

-   `client_id` **[string][77]?** Platform client id.

### platformKid

Gets the platform key_id.

### platformPublicKey

Gets the RSA public key assigned to the platform.

### platformPrivateKey

Gets the RSA private key assigned to the platform.

### platformAuthConfig

Sets/Gets the platform authorization configurations used to validate it's messages.

#### Parameters

-   `method` **[string][77]** Method of authorization "RSA_KEY" or "JWK_KEY" or "JWK_SET".
-   `key` **[string][77]** Either the RSA public key provided by the platform, or the JWK key, or the JWK keyset address.

### platformAuthEndpoint

Sets/Gets the platform authorization endpoint used to perform the OIDC login.

#### Parameters

-   `auth_endpoint` **[string][77]?** Platform authorization endpoint.

### platformAccessTokenEndpoint

Sets/Gets the platform access token endpoint used to authenticate messages to the platform.

#### Parameters

-   `accesstoken_endpoint` **[string][77]?** Platform access token endpoint.

### platformAccessToken

Returns a promise that resolves into the platform's access token or generate a new one.

### remove

Deletes a registered platform.

## Auth

Authentication class manages RSA keys and validation of tokens.

### generateProviderKeyPair

Generates a new keypairfor the platform.

Returns **[String][77]** kid for the keypair.

### validateToken

Resolves a promisse if the token is valid following LTI 1.3 standards.

#### Parameters

-   `token` **[String][77]** JWT token to be verified.
-   `getPlatform` **[Function][75]** getPlatform function to get the platform that originated the token.

Returns **[Promise][78]** 

### verifyToken

Verifies a token.

#### Parameters

-   `token` **[Object][73]** Token to be verified.
-   `key` **[String][77]** Key to verify the token.
-   `alg` **[String][77]** Algorithm used.
-   `platform` **[Platform][79]** Issuer platform.

### oidcValidationSteps

Validates de token based on the OIDC specifications.

#### Parameters

-   `token` **[Object][73]** Id token you wish to validate.
-   `platform` **[Platform][79]** Platform object.
-   `alg`  

### getAccessToken

Gets a new access token from the platform.

#### Parameters

-   `platform` **[Platform][79]** Platform object of the platform you want to access.
-   `ENCRYPTIONKEY`  

### deleteNonce

Starts up timer to delete nonce.

#### Parameters

-   `nonce` **[String][77]** Nonce.

### deleteAccessToken

Starts up timer to delete access token.

#### Parameters

-   `url` **[String][77]** Platform url.
-   `time`  

## Database

Set of static classes to manipulate the database

### Get

Get item or entire database.

#### Parameters

-   `ENCRYPTIONKEY` **[string][77]** Encryptionkey of the database, false if none
-   `path` **[String][77]** Path of database to be accessed.
-   `database` **[String][77]** Database name.
-   `set` **[string][77]** The set to be accessed inside the database.
-   `query` **[object][73]?** Query for the item you are looking for in the format {type: "type1"}.

### Insert

Insert item in database.

#### Parameters

-   `ENCRYPTIONKEY` **[string][77]** Encryptionkey of the database, false if none.
-   `path` **[string][77]** Path of database to be accessed.
-   `database` **[string][77]** Database name.
-   `set` **[string][77]** The set to be accessed inside the database.
-   `item` **[object][73]** The item object you want to insert in the database.

### Modify

Assign value to item in database

#### Parameters

-   `ENCRYPTIONKEY` **[string][77]** Encryptionkey of the database, false if none.
-   `path` **[string][77]** Path of database to be accessed.
-   `database` **[string][77]** Database name.
-   `set` **[string][77]** The set to be accessed inside the database.
-   `query` **[object][73]** The entry you want to modify in the format {type: "type1"}.
-   `modification` **[object][73]** The modification you want to make in the format {type: "type2"}.

### Delete

Delete item in database

#### Parameters

-   `ENCRYPTIONKEY` **[string][77]** Encryptionkey of the database, false if none.
-   `path` **[string][77]** Path of database to be accessed.
-   `database` **[string][77]** Database name.
-   `set` **[string][77]** The set to be accessed inside the database.
-   `query` **[object][73]** The entry you want to delete in the format {type: "type1"}.

[1]: #provider

[2]: #parameters

[3]: #deploy

[4]: #parameters-1

[5]: #onconnect

[6]: #parameters-2

[7]: #examples

[8]: #loginurl

[9]: #parameters-3

[10]: #examples-1

[11]: #appurl

[12]: #parameters-4

[13]: #examples-2

[14]: #sessiontimeouturl

[15]: #parameters-5

[16]: #examples-3

[17]: #invalidtokenurl

[18]: #parameters-6

[19]: #examples-4

[20]: #registerplatform

[21]: #parameters-7

[22]: #getplatform

[23]: #parameters-8

[24]: #deleteplatform

[25]: #parameters-9

[26]: #getallplatforms

[27]: #messageplatform

[28]: #parameters-10

[29]: #lti1_3login

[30]: #parameters-11

[31]: #platform

[32]: #parameters-12

[33]: #platformname

[34]: #parameters-13

[35]: #platformurl

[36]: #parameters-14

[37]: #platformclientid

[38]: #parameters-15

[39]: #platformkid

[40]: #platformpublickey

[41]: #platformprivatekey

[42]: #platformauthconfig

[43]: #parameters-16

[44]: #platformauthendpoint

[45]: #parameters-17

[46]: #platformaccesstokenendpoint

[47]: #parameters-18

[48]: #platformaccesstoken

[49]: #remove

[50]: #auth

[51]: #generateproviderkeypair

[52]: #validatetoken

[53]: #parameters-19

[54]: #verifytoken

[55]: #parameters-20

[56]: #oidcvalidationsteps

[57]: #parameters-21

[58]: #getaccesstoken

[59]: #parameters-22

[60]: #deletenonce

[61]: #parameters-23

[62]: #deleteaccesstoken

[63]: #parameters-24

[64]: #database

[65]: #get

[66]: #parameters-25

[67]: #insert

[68]: #parameters-26

[69]: #modify

[70]: #parameters-27

[71]: #delete

[72]: #parameters-28

[73]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[74]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[75]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[76]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[77]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[78]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[79]: #platform
